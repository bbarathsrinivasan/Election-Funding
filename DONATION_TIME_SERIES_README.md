# Donation Time Series Analysis

## Overview

This analysis generates comprehensive time series visualizations of US election donations, showing trends over time segmented by donor size (Small, Medium, Large) and party (Democratic, Republican).

## Features

### Visualization Types

1. **Cumulative Ratio Plots (16 plots)**
   - **Democratic Ratio**: `(Dem Donations + Rep Donations) / Dem Donations`
     - Ratio > 2.0 indicates more Democratic donations
     - Ratio < 2.0 indicates fewer Democratic donations
     - Ratio = 2.0 indicates equal donations from both parties
   
   - **Republican Ratio**: `(Dem Donations + Rep Donations) / Rep Donations`
     - Ratio > 2.0 indicates more Republican donations
     - Ratio < 2.0 indicates fewer Republican donations
     - Ratio = 2.0 indicates equal donations from both parties
   
   - Generated for: All donors, Small donors, Medium donors, Large donors
   - Time periods: Weekly, Monthly

2. **Party Donation Time Series (16 plots)**
   - **Democratic Donations**: Total Democratic donations over time
   - **Republican Donations**: Total Republican donations over time
   - Generated for: All donors, Small donors, Medium donors, Large donors
   - Time periods: Weekly, Monthly

### Total Plots Generated: 32

## Data Processing Pipeline

### Input Files Required

1. `US_Election_Donation.csv` - Complete US election donation records (~70M records)
   - Columns: Party, Candidate, Candidate_ID, Donator, Received, Donation_Amount_USD, etc.
   
2. `donor_segments.csv` - Donor segmentation data (generated by `segment_election_donors.py`)
   - Columns: Donator, Cumulative_Donation_USD, Number_of_Donations, Donor_Segment

### Processing Steps

**Step 1: Data Preparation** (`prepare_donation_time_series.py`)
- Loads donor segment classifications
- Processes 70M+ donation records in chunks (memory efficient)
- Parses date fields (MMDDYYYY format)
- Filters for Democratic (DEM) and Republican (REP) parties only
- Joins donation data with donor segments
- Creates weekly and monthly aggregations
- Saves processed data and aggregations

**Step 2: Visualization** (`plot_donation_time_series.py`)
- Loads aggregated data
- Generates 32 plots with consistent styling
- Creates summary statistics
- Saves all plots to `donation_time_series_plots/`

### Running the Analysis

#### Option 1: Run Complete Pipeline (Recommended)
```bash
python3 run_donation_time_series_analysis.py
```
This runs both data preparation and visualization sequentially.

#### Option 2: Run Steps Individually
```bash
# Step 1: Prepare data (takes 10-15 minutes)
python3 prepare_donation_time_series.py

# Step 2: Generate visualizations (takes 2-3 minutes)
python3 plot_donation_time_series.py
```

## Output Files

### Directory Structure
```
donation_time_series_data/
├── processed_donations.csv           # All processed donation records
├── weekly_aggregations.csv           # Weekly aggregations by party & segment
└── monthly_aggregations.csv          # Monthly aggregations by party & segment

donation_time_series_plots/
├── cumulative_ratio_weekly_all_dem.png
├── cumulative_ratio_weekly_small_dem.png
├── cumulative_ratio_weekly_medium_dem.png
├── cumulative_ratio_weekly_large_dem.png
├── cumulative_ratio_monthly_all_dem.png
├── cumulative_ratio_monthly_small_dem.png
├── cumulative_ratio_monthly_medium_dem.png
├── cumulative_ratio_monthly_large_dem.png
├── cumulative_ratio_weekly_all_rep.png
├── cumulative_ratio_weekly_small_rep.png
├── cumulative_ratio_weekly_medium_rep.png
├── cumulative_ratio_weekly_large_rep.png
├── cumulative_ratio_monthly_all_rep.png
├── cumulative_ratio_monthly_small_rep.png
├── cumulative_ratio_monthly_medium_rep.png
├── cumulative_ratio_monthly_large_rep.png
├── dem_donations_weekly_all.png
├── dem_donations_weekly_small.png
├── dem_donations_weekly_medium.png
├── dem_donations_weekly_large.png
├── dem_donations_monthly_all.png
├── dem_donations_monthly_small.png
├── dem_donations_monthly_medium.png
├── dem_donations_monthly_large.png
├── rep_donations_weekly_all.png
├── rep_donations_weekly_small.png
├── rep_donations_weekly_medium.png
├── rep_donations_weekly_large.png
├── rep_donations_monthly_all.png
├── rep_donations_monthly_small.png
├── rep_donations_monthly_medium.png
├── rep_donations_monthly_large.png
└── donation_time_series_summary.csv  # Summary statistics
```

## Interpretation Guide

### Cumulative Ratio Plots

**Democratic Ratio: (Dem + Rep) / Dem**
- **Value = 2.0**: Both parties received equal donations
- **Value > 2.0**: Democratic party received more donations (e.g., 2.5 means Dem received 60% of total)
- **Value < 2.0**: Democratic party received fewer donations (e.g., 1.5 means Dem received 33% of total)

**Republican Ratio: (Dem + Rep) / Rep**
- **Value = 2.0**: Both parties received equal donations
- **Value > 2.0**: Republican party received more donations (e.g., 2.5 means Rep received 60% of total)
- **Value < 2.0**: Republican party received fewer donations (e.g., 1.5 means Rep received 33% of total)

### Party Donation Plots

- **Bar charts** show absolute donation amounts per time period
- **Height** indicates total donations in USD
- Compare across donor segments to see which group contributes most
- Compare weekly vs monthly to identify donation patterns and trends

## Key Insights to Look For

1. **Temporal Patterns**
   - Seasonal trends in donations
   - Election cycle effects
   - Major event impacts

2. **Donor Segment Behavior**
   - Do large donors follow different patterns than small donors?
   - Which segment contributes most consistently?
   - How do segments respond to political events?

3. **Party Competition**
   - Which party has stronger donation trends?
   - Are ratio trends stable or volatile?
   - How do donor segments differ in party preference?

## Technical Details

### Date Parsing
- Input format: MMDDYYYY (e.g., 7312023 = July 31, 2023)
- Also handles MDDYYYY format (e.g., 712023 = July 1, 2023)
- Invalid dates are filtered out

### Week Definition
- Uses ISO week numbering (Monday start)
- Format: YYYY-Www (e.g., 2023-W30)

### Month Definition
- Uses calendar months
- Format: YYYY-MM (e.g., 2023-07)

### Memory Optimization
- Processes data in 1M record chunks
- Filters irrelevant records early
- Uses efficient data types

### Performance
- **Data Preparation**: ~10-20 minutes (depends on system)
- **Visualization**: ~2-3 minutes
- **Total Time**: ~15-25 minutes

## Dependencies

```python
pandas
numpy
matplotlib
seaborn
```

Install with:
```bash
pip install pandas numpy matplotlib seaborn
```

## Notes

- Only includes donations to DEM and REP parties
- Requires prior segmentation (run `segment_election_donors.py` first)
- Large file processing may require 4-8GB RAM
- All monetary values in USD

## Troubleshooting

**Issue**: "Aggregation files not found"
- **Solution**: Run `prepare_donation_time_series.py` first

**Issue**: "donor_segments.csv not found"
- **Solution**: Run `segment_election_donors.py` to create donor segments

**Issue**: Out of memory error
- **Solution**: Reduce `chunk_size` in `prepare_donation_time_series.py` (line 54)

**Issue**: Processing takes too long
- **Solution**: This is normal for 70M records. Consider using a subset for testing.

## Related Scripts

- `segment_election_donors.py` - Creates donor segmentation (prerequisite)
- `visualize_donor_segments.py` - Creates donor segment statistics visualizations
- `orchestration_script.py` - Master script for all donation analyses

## Contact & Support

For issues or questions about this analysis, refer to the main project documentation.
